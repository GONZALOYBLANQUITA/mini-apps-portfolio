<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#0B2D5C" />
  <title>Sebastián | Entrenamiento de Respuesta (ULima)</title>

  <style>
    :root{
      /* Paleta ULima (aprox): Azul + Dorado */
      --ulima-blue: #0B2D5C;
      --ulima-blue-2: #123E7A;
      --ulima-gold: #F2B705;
      --ulima-gold-2: #E0A700;

      --bg: #071A33;
      --card: rgba(255,255,255,.07);
      --card2: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --muted2: rgba(255,255,255,.55);
      --border: rgba(255,255,255,.12);

      --ok: #35D07F;
      --warn: #FFC857;
      --bad: #FF5C7A;

      --radius: 18px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --shadow2: 0 6px 20px rgba(0,0,0,.25);

      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(242,183,5,.22), transparent 60%),
        radial-gradient(900px 600px at 90% 20%, rgba(18,62,122,.45), transparent 60%),
        linear-gradient(180deg, var(--bg), #06152B 40%, #040F1F);
      padding: calc(14px + var(--safe-top)) 14px calc(18px + var(--safe-bottom));
    }

    .app{
      max-width: 980px;
      margin: 0 auto;
      display:flex;
      flex-direction:column;
      gap: 14px;
    }

    header{
      display:flex;
      gap: 12px;
      align-items:center;
      padding: 14px 14px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(11,45,92,.55), rgba(255,255,255,.06));
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      position: sticky;
      top: calc(6px + var(--safe-top));
      backdrop-filter: blur(10px);
      z-index: 5;
    }
    .brand{
      display:flex; align-items:center; gap: 10px; flex:1;
      min-width: 0;
    }
    .logo{
      width: 44px; height: 44px;
      border-radius: 14px;
      display:grid; place-items:center;
      background: linear-gradient(135deg, var(--ulima-blue), var(--ulima-blue-2));
      border: 1px solid rgba(242,183,5,.28);
      box-shadow: 0 10px 22px rgba(0,0,0,.25);
      flex: 0 0 auto;
    }
    .titlewrap{min-width:0}
    h1{
      margin:0;
      font-size: 16px;
      letter-spacing: .2px;
      line-height: 1.25;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .subtitle{
      font-size: 12.5px;
      color: var(--muted);
      margin-top: 2px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 9px 11px;
      border-radius: 999px;
      border: 1px solid rgba(242,183,5,.35);
      background: rgba(242,183,5,.10);
      color: rgba(255,255,255,.92);
      font-size: 12.5px;
      user-select:none;
      flex: 0 0 auto;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 14px;
    }
    @media (max-width: 860px){
      .grid{grid-template-columns: 1fr}
      header{position:static}
    }

    .card{
      background: linear-gradient(180deg, var(--card2), var(--card));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 14px 14px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
    }
    .card .head .left{
      display:flex; align-items:center; gap: 10px;
      min-width: 0;
    }
    .card h2{
      margin:0;
      font-size: 14px;
      letter-spacing:.2px;
      line-height:1.2;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .small{
      font-size: 12.5px;
      color: var(--muted);
      line-height: 1.45;
      margin: 0;
    }
    .content{
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    .tabs{
      display:flex; gap: 10px; flex-wrap:wrap;
    }
    .tabbtn{
      display:flex; align-items:center; gap: 8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-size: 12.5px;
      cursor:pointer;
      user-select:none;
      transition: transform .05s ease, background .2s ease, border .2s ease;
    }
    .tabbtn:active{transform: scale(.98)}
    .tabbtn.active{
      border-color: rgba(242,183,5,.55);
      background: rgba(242,183,5,.12);
    }

    .row{
      display:flex;
      gap: 10px;
      align-items:stretch;
      flex-wrap:wrap;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(242,183,5,.35);
      background: linear-gradient(180deg, rgba(242,183,5,.20), rgba(242,183,5,.10));
      color: var(--text);
      cursor:pointer;
      font-weight: 650;
      letter-spacing: .2px;
      box-shadow: 0 10px 20px rgba(0,0,0,.25);
      user-select:none;
      transition: transform .05s ease, filter .2s ease;
      flex: 1 1 auto;
      min-width: 180px;
    }
    .btn:active{transform: scale(.98)}
    .btn.secondary{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      box-shadow: none;
      font-weight: 600;
    }
    .btn.danger{
      border-color: rgba(255,92,122,.45);
      background: rgba(255,92,122,.12);
    }

    .kpi{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    @media (max-width: 520px){
      .kpi{grid-template-columns: 1fr}
      .btn{min-width: 100%}
    }
    .kpi .box{
      padding: 12px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
    }
    .kpi .label{font-size: 12px; color: var(--muted)}
    .kpi .value{font-size: 18px; font-weight: 800; margin-top: 4px; letter-spacing:.2px}
    .kpi .hint{font-size: 12px; color: var(--muted2); margin-top: 4px}

    .panel{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      border-radius: 16px;
      padding: 12px;
    }
    .panel strong{color: rgba(255,255,255,.95)}
    .panel .muted{color: var(--muted); font-size: 12.5px; line-height:1.5}

    .split{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 820px){ .split{grid-template-columns: 1fr} }

    .input, textarea{
      width: 100%;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      color: var(--text);
      border-radius: 14px;
      padding: 12px 12px;
      outline:none;
      font-size: 14px;
      line-height: 1.45;
    }
    textarea{min-height: 120px; resize: vertical}
    .fieldlabel{
      font-size: 12px;
      color: var(--muted);
      margin: 0 0 6px 2px;
    }

    .chips{
      display:flex; flex-wrap:wrap; gap: 8px;
    }
    .chip{
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.05);
      color: var(--text);
      font-size: 12.5px;
      cursor:pointer;
      user-select:none;
    }
    .chip.active{
      border-color: rgba(242,183,5,.55);
      background: rgba(242,183,5,.12);
    }

    .list{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .checkrow{
      display:flex;
      gap: 10px;
      align-items:flex-start;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.05);
    }
    input[type="checkbox"]{
      width: 20px; height: 20px; margin-top: 2px;
      accent-color: var(--ulima-gold);
    }
    .checkrow .t{
      font-weight: 750;
      font-size: 13px;
      margin: 0;
    }
    .checkrow .d{
      font-size: 12.5px;
      color: var(--muted);
      margin: 3px 0 0 0;
      line-height: 1.35;
    }

    .timer{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(242,183,5,.35);
      background: rgba(242,183,5,.09);
    }
    .time{
      font-size: 28px;
      font-weight: 900;
      letter-spacing: .6px;
    }
    .timehint{font-size: 12px; color: rgba(255,255,255,.75); margin-top: 2px}

    .hr{
      height: 1px;
      background: var(--border);
      margin: 8px 0;
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: calc(16px + var(--safe-bottom));
      transform: translateX(-50%);
      background: rgba(0,0,0,.70);
      border: 1px solid rgba(255,255,255,.16);
      padding: 10px 12px;
      border-radius: 14px;
      color: rgba(255,255,255,.92);
      font-size: 12.5px;
      box-shadow: var(--shadow2);
      opacity: 0;
      pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
      z-index: 50;
      max-width: min(92vw, 520px);
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-4px);
    }

    .foot{
      padding: 14px;
      color: rgba(255,255,255,.62);
      font-size: 12px;
      text-align:center;
    }

    /* Icon sizing */
    .ico{width:18px;height:18px;display:inline-block}
    .ico.big{width:20px;height:20px}
    .ico.xl{width:22px;height:22px}
    svg{fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      *{transition:none !important}
    }
  </style>
</head>

<body>
  <div class="app" role="application" aria-label="Mini app de entrenamiento de respuesta para Sebastián">

    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <!-- simple monograma -->
          <svg class="ico xl" viewBox="0 0 24 24" style="color: rgba(242,183,5,.95);">
            <path d="M4 18V6"/>
            <path d="M20 18V6"/>
            <path d="M4 6h10a4 4 0 0 1 0 8H4"/>
            <path d="M20 18H9a4 4 0 0 1 0-8h11"/>
          </svg>
        </div>
        <div class="titlewrap">
          <h1>Sebastián · Respuestas ordenadas</h1>
          <div class="subtitle">Esqueleto 10s · Plantillas I–E–I–C / A–R–D–C · Protocolo de examen</div>
        </div>
      </div>

      <div class="pill" id="streakPill" title="Racha de práctica">
        <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 2s4 4 4 8a4 4 0 0 1-8 0c0-4 4-8 4-8z"/>
          <path d="M6 22c1.2-3.3 3.5-4.8 6-5 2.5.2 4.8 1.7 6 5"/>
        </svg>
        <span><strong id="streakVal">0</strong> días</span>
      </div>
    </header>

    <div class="grid">
      <!-- IZQUIERDA: flujo principal -->
      <section class="card" aria-label="Entrenamiento principal">
        <div class="head">
          <div class="left">
            <svg class="ico big" viewBox="0 0 24 24" aria-hidden="true" style="color: rgba(242,183,5,.95);">
              <path d="M12 21s7-4.4 7-10a7 7 0 0 0-14 0c0 5.6 7 10 7 10z"/>
              <path d="M12 11v4"/>
              <path d="M12 8h.01"/>
            </svg>
            <h2>Modo de práctica (rápido y guiado)</h2>
          </div>
          <button class="tabbtn" id="btnResetDay" title="Reiniciar checklist del día">
            <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M21 12a9 9 0 1 1-3-6.7"/>
              <path d="M21 3v7h-7"/>
            </svg>
            Día
          </button>
        </div>

        <div class="content">
          <div class="tabs" role="tablist" aria-label="Secciones">
            <button class="tabbtn active" data-tab="tabPractica" role="tab">
              <svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M7 7h10"/><path d="M7 12h10"/><path d="M7 17h6"/><path d="M5 4h14v16H5z"/></svg>
              Practicar
            </button>
            <button class="tabbtn" data-tab="tabExamen" role="tab">
              <svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M9 11h6"/><path d="M9 15h6"/><path d="M7 3h10v18H7z"/><path d="M9 7h6"/></svg>
              Protocolo
            </button>
            <button class="tabbtn" data-tab="tabPlantillas" role="tab">
              <svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M4 4h16v16H4z"/><path d="M8 8h8"/><path d="M8 12h8"/><path d="M8 16h6"/></svg>
              Plantillas
            </button>
            <button class="tabbtn" data-tab="tabNotas" role="tab">
              <svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M4 4h12l4 4v12H4z"/><path d="M8 13h8"/><path d="M8 17h8"/><path d="M8 9h4"/></svg>
              Notas
            </button>
          </div>

          <!-- TAB: PRACTICA -->
          <div id="tabPractica" class="tab">
            <div class="panel">
              <div style="display:flex;align-items:flex-start;gap:10px;">
                <div style="margin-top:2px;color:rgba(242,183,5,.95)">
                  <svg class="ico xl" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M12 2v6"/>
                    <path d="M12 16v6"/>
                    <path d="M4.9 4.9l4.3 4.3"/>
                    <path d="M14.8 14.8l4.3 4.3"/>
                    <path d="M2 12h6"/>
                    <path d="M16 12h6"/>
                    <path d="M4.9 19.1l4.3-4.3"/>
                    <path d="M14.8 9.2l4.3-4.3"/>
                  </svg>
                </div>
                <div>
                  <strong>Regla de oro:</strong>
                  <div class="muted">Constancia &gt; perfección. Hoy entrenamos orden, no velocidad.</div>
                </div>
              </div>
            </div>

            <div class="split">
              <div>
                <div class="fieldlabel">1) Pega aquí la pregunta del examen (o una pregunta de práctica)</div>
                <textarea id="qInput" placeholder="Ej.: Explique el concepto de X y su relevancia para el Derecho."></textarea>
              </div>

              <div>
                <div class="fieldlabel">2) Selecciona el tipo de respuesta (elige 1)</div>
                <div class="chips" id="modeChips">
                  <div class="chip active" data-mode="ieic">I–E–I–C (filosofía/explicación)</div>
                  <div class="chip" data-mode="ardc">A–R–D–C (argumentación)</div>
                </div>

                <div class="hr"></div>

                <div class="fieldlabel">3) Esqueleto de 10 segundos (3–5 palabras clave en orden)</div>
                <input class="input" id="skeletonInput" placeholder="Palabra1 · Palabra2 · Palabra3 · ..." />
                <p class="small" style="margin-top:8px;">
                  Tip: si te aceleras, vuelve al esqueleto y reordena.
                </p>
              </div>
            </div>

            <div class="timer" aria-label="Temporizador de 10 segundos">
              <div>
                <div class="time" id="timerVal">00:10</div>
                <div class="timehint" id="timerHint">Esqueleto 10s: freno + orden</div>
              </div>
              <div class="row" style="justify-content:flex-end;gap:10px;">
                <button class="btn secondary" id="btn10s">
                  <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M12 2v4"/>
                    <path d="M12 18v4"/>
                    <path d="M4.9 4.9l2.8 2.8"/>
                    <path d="M16.3 16.3l2.8 2.8"/>
                    <path d="M2 12h4"/>
                    <path d="M18 12h4"/>
                    <path d="M4.9 19.1l2.8-2.8"/>
                    <path d="M16.3 7.7l2.8-2.8"/>
                    <path d="M12 6a6 6 0 1 1 0 12"/>
                  </svg>
                  10s
                </button>
                <button class="btn danger" id="btnStop">
                  <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M6 6h12v12H6z"/>
                  </svg>
                  Stop
                </button>
              </div>
            </div>

            <div class="panel">
              <div class="fieldlabel">4) Respuesta guiada (usa la plantilla seleccionada)</div>
              <textarea id="answerBox" placeholder="Escribe tu respuesta usando la estructura..."></textarea>

              <div class="row" style="margin-top:10px;">
                <button class="btn" id="btnInsertTemplate">
                  <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M12 5v14"/>
                    <path d="M5 12h14"/>
                  </svg>
                  Insertar plantilla
                </button>
                <button class="btn secondary" id="btnQuickStart">
                  <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M8 5v14"/>
                    <path d="M8 12l10-7v14z"/>
                  </svg>
                  Arranque 30s
                </button>
                <button class="btn secondary" id="btnSavePractice">
                  <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                    <path d="M17 21v-8H7v8"/>
                    <path d="M7 3v5h8"/>
                  </svg>
                  Guardar práctica
                </button>
              </div>

              <div class="hr"></div>

              <div class="kpi" aria-label="Indicadores rápidos">
                <div class="box">
                  <div class="label">Prácticas guardadas</div>
                  <div class="value" id="kpiPractices">0</div>
                  <div class="hint">Meta: 1–2 por día</div>
                </div>
                <div class="box">
                  <div class="label">Hoy</div>
                  <div class="value" id="kpiToday">0</div>
                  <div class="hint">Constancia &gt; perfección</div>
                </div>
                <div class="box">
                  <div class="label">Calma</div>
                  <div class="value" id="kpiCalm">—</div>
                  <div class="hint">¿Se activó? Vuelve al esqueleto</div>
                </div>
              </div>
            </div>

            <div class="panel" id="practicePrompts">
              <strong>Preguntas de práctica (toca para copiar)</strong>
              <div class="muted" style="margin-top:4px;">Entrena con preguntas tipo “Explica + Relevancia” o “Tesis + Razón”.</div>
              <div class="chips" style="margin-top:10px;">
                <div class="chip" data-prompt="Explique el concepto central del texto y su relevancia para el Derecho.">Concepto + relevancia</div>
                <div class="chip" data-prompt="Defina el término y ejemplifique brevemente su aplicación.">Definir + ejemplificar</div>
                <div class="chip" data-prompt="Sostenga una afirmación sobre el tema y justifíquela con una razón.">Afirmar + justificar</div>
                <div class="chip" data-prompt="Compare dos ideas del autor: convergencias y diferencias.">Comparar ideas</div>
                <div class="chip" data-prompt="Explique por qué esta idea es importante hoy y cierre con una conclusión clara.">Importancia + cierre</div>
              </div>
            </div>
          </div>

          <!-- TAB: EXAMEN -->
          <div id="tabExamen" class="tab" style="display:none;">
            <div class="panel">
              <strong>Protocolo de Examen (anti-aceleración)</strong>
              <div class="muted" style="margin-top:6px; line-height:1.5;">
                Objetivo: que tu respuesta sea <strong>ordenada</strong> aunque estés activado. Si el cuerpo se acelera, vuelves al guion.
              </div>
            </div>

            <div class="list" id="examChecklist">
              <!-- items via JS -->
            </div>

            <div class="row">
              <button class="btn secondary" id="btnMarkAll">
                <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M20 6L9 17l-5-5"/>
                </svg>
                Marcar todo (hoy)
              </button>
              <button class="btn danger" id="btnClearAll">
                <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M3 6h18"/>
                  <path d="M8 6V4h8v2"/>
                  <path d="M19 6l-1 14H6L5 6"/>
                  <path d="M10 11v6"/>
                  <path d="M14 11v6"/>
                </svg>
                Limpiar
              </button>
            </div>

            <div class="panel">
              <strong>Guion de emergencia (cuando te “sales”)</strong>
              <div class="muted" style="margin-top:6px;">
                1) Pausa 3 respiraciones (4–6).<br/>
                2) Esqueleto 10s (3–5 palabras).<br/>
                3) Vuelve a la plantilla (I–E–I–C o A–R–D–C).<br/>
                4) Cierra con 1 frase final.
              </div>
            </div>
          </div>

          <!-- TAB: PLANTILLAS -->
          <div id="tabPlantillas" class="tab" style="display:none;">
            <div class="panel">
              <strong>Plantillas listas</strong>
              <div class="muted" style="margin-top:6px;">
                Usa estas estructuras para que tu mente no improvise bajo presión.
              </div>
            </div>

            <div class="split">
              <div class="panel">
                <strong>I – E – I – C</strong>
                <div class="muted" style="margin-top:6px;">
                  <strong>I</strong> Introducción: define el concepto / presenta la idea central.<br/>
                  <strong>E</strong> Explicación: desarrolla la idea con claridad (1 idea por párrafo).<br/>
                  <strong>I</strong> Interpretación: relaciónalo con el Derecho / relevancia / implicancia.<br/>
                  <strong>C</strong> Cierre: síntesis final en 1–2 frases.
                </div>
                <div class="row" style="margin-top:10px;">
                  <button class="btn secondary" data-copy="tpl_ieic">
                    <svg class="ico" viewBox="0 0 24 24"><path d="M8 8h12v12H8z"/><path d="M4 4h12v12H4z"/></svg>
                    Copiar
                  </button>
                </div>
              </div>

              <div class="panel">
                <strong>A – R – D – C</strong>
                <div class="muted" style="margin-top:6px;">
                  <strong>A</strong> Afirmación: tu tesis (qué sostienes).<br/>
                  <strong>R</strong> Razón: por qué (justificación principal).<br/>
                  <strong>D</strong> Desarrollo: explica y ejemplifica (sin mezclar ideas).<br/>
                  <strong>C</strong> Conclusión: cierre claro y directo.
                </div>
                <div class="row" style="margin-top:10px;">
                  <button class="btn secondary" data-copy="tpl_ardc">
                    <svg class="ico" viewBox="0 0 24 24"><path d="M8 8h12v12H8z"/><path d="M4 4h12v12H4z"/></svg>
                    Copiar
                  </button>
                </div>
              </div>
            </div>

            <div class="panel">
              <strong>Reglas rápidas (anti-mezcla)</strong>
              <div class="muted" style="margin-top:6px;">
                • 1 párrafo = 1 idea.<br/>
                • Conectores: “Por ello…”, “En consecuencia…”, “Esto implica…”.<br/>
                • Si te trabas: escribe el cierre primero y luego vuelves al cuerpo.
              </div>
            </div>
          </div>

          <!-- TAB: NOTAS -->
          <div id="tabNotas" class="tab" style="display:none;">
            <div class="panel">
              <strong>Notas y ajustes personales</strong>
              <div class="muted" style="margin-top:6px;">Aquí guardas tus recordatorios para el examen. Se queda en tu teléfono.</div>
            </div>

            <div>
              <div class="fieldlabel">Mantra (se muestra arriba)</div>
              <input class="input" id="mantraInput" placeholder="Ej.: Orden > velocidad. Respondo con guion." />
            </div>

            <div>
              <div class="fieldlabel">Mis conectores favoritos</div>
              <input class="input" id="connectorsInput" placeholder="Ej.: Por ello · En consecuencia · Esto implica · Además" />
              <p class="small" style="margin-top:8px;">Tip: úsalos para “amarrar” el texto y evitar saltos.</p>
            </div>

            <div>
              <div class="fieldlabel">Notas rápidas</div>
              <textarea id="notesBox" placeholder="Ej.: No empezar sin esqueleto. Cerrar sí o sí con 1 frase final."></textarea>
            </div>

            <div class="row">
              <button class="btn secondary" id="btnSaveNotes">
                <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                  <path d="M17 21v-8H7v8"/>
                  <path d="M7 3v5h8"/>
                </svg>
                Guardar
              </button>
              <button class="btn danger" id="btnWipeAll">
                <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M3 6h18"/>
                  <path d="M8 6V4h8v2"/>
                  <path d="M19 6l-1 14H6L5 6"/>
                  <path d="M10 11v6"/>
                  <path d="M14 11v6"/>
                </svg>
                Borrar todo
              </button>
            </div>
          </div>

        </div>
      </section>

      <!-- DERECHA: panel de control -->
      <aside class="card" aria-label="Panel de control">
        <div class="head">
          <div class="left">
            <svg class="ico big" viewBox="0 0 24 24" aria-hidden="true" style="color: rgba(242,183,5,.95);">
              <path d="M12 3v18"/>
              <path d="M3 12h18"/>
              <path d="M5 5l14 14"/>
              <path d="M19 5L5 19"/>
            </svg>
            <h2>Control (calma + orden)</h2>
          </div>
        </div>

        <div class="content">
          <div class="panel" id="mantraPanel">
            <strong id="mantraText">Orden &gt; velocidad. Respondo con guion.</strong>
            <div class="muted" style="margin-top:6px;">Si te aceleras: vuelve al esqueleto y a la plantilla.</div>
          </div>

          <div class="panel">
            <strong>Calma (30 segundos)</strong>
            <div class="muted" style="margin-top:6px; line-height:1.55;">
              Inhala 4 · Exhala 6 (x3). Luego: “¿Cuál es mi esqueleto de 3–5 palabras?”
            </div>
            <div class="row" style="margin-top:10px;">
              <button class="btn secondary" id="btnCalm">
                <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 3a9 9 0 0 0 0 18"/>
                  <path d="M12 3a9 9 0 0 1 0 18"/>
                  <path d="M12 7v5l3 2"/>
                </svg>
                Iniciar 30s
              </button>
              <button class="btn secondary" id="btnSetCalmOk" title="Marcar calma como lograda">
                <svg class="ico" viewBox="0 0 24 24"><path d="M20 6L9 17l-5-5"/></svg>
                OK
              </button>
            </div>
          </div>

          <div class="panel">
            <strong>Conectores</strong>
            <div class="muted" id="connectorsView" style="margin-top:6px; line-height:1.6;">
              Por ello · En consecuencia · Esto implica · Además
            </div>
            <div class="row" style="margin-top:10px;">
              <button class="btn secondary" id="btnCopyConnectors">
                <svg class="ico" viewBox="0 0 24 24"><path d="M8 8h12v12H8z"/><path d="M4 4h12v12H4z"/></svg>
                Copiar
              </button>
            </div>
          </div>

          <div class="panel">
            <strong>Registros recientes</strong>
            <div class="muted" style="margin-top:6px;">Las últimas 5 prácticas guardadas.</div>
            <div class="hr"></div>
            <div id="recentList" class="small" style="line-height:1.55;"></div>
          </div>

          <div class="panel">
            <strong>Tip iOS</strong>
            <div class="muted" style="margin-top:6px;">
              Para usar como app: Safari → Compartir → <em>Agregar a pantalla de inicio</em>.
            </div>
          </div>

          <div class="foot">
            Hecho para entrenar <strong>orden</strong>, <strong>inhibición</strong> y <strong>estructura</strong> bajo presión.
          </div>
        </div>
      </aside>
    </div>

  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    // ---------- Storage helpers ----------
    const LS = {
      get(key, fallback){
        try{
          const raw = localStorage.getItem(key);
          return raw ? JSON.parse(raw) : fallback;
        }catch(e){ return fallback; }
      },
      set(key, value){
        localStorage.setItem(key, JSON.stringify(value));
      }
    };

    // ---------- State ----------
    const state = {
      mode: LS.get("seb_mode", "ieic"),
      practices: LS.get("seb_practices", []), // {ts, q, skeleton, mode, answer}
      notes: LS.get("seb_notes", ""),
      mantra: LS.get("seb_mantra", "Orden > velocidad. Respondo con guion."),
      connectors: LS.get("seb_connectors", "Por ello · En consecuencia · Esto implica · Además"),
      calmToday: LS.get("seb_calm_today", { date: todayKey(), ok:false }),
      checklist: LS.get("seb_checklist", { date: todayKey(), items:{} }),
      streak: LS.get("seb_streak", { last: null, count: 0, todayDone: false })
    };

    function todayKey(){
      const d = new Date();
      // local day key yyyy-mm-dd
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      return `${y}-${m}-${day}`;
    }

    function showToast(msg){
      const el = document.getElementById("toast");
      el.textContent = msg;
      el.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>el.classList.remove("show"), 1800);
    }

    // ---------- Templates ----------
    const TPL = {
      ieic:
`I) Introducción (definición / idea central):
- 

E) Explicación (1 idea por párrafo):
- 

I) Interpretación (relevancia / implicancia para el Derecho):
- 

C) Cierre (síntesis final 1–2 frases):
- `,
      ardc:
`A) Afirmación (tesis):
- 

R) Razón (por qué):
- 

D) Desarrollo (explicación + ejemplo):
- 

C) Conclusión (cierre claro):
- `
    };

    // ---------- Tabs ----------
    const tabButtons = Array.from(document.querySelectorAll(".tabbtn[data-tab]"));
    const tabs = ["tabPractica", "tabExamen", "tabPlantillas", "tabNotas"];

    tabButtons.forEach(btn=>{
      btn.addEventListener("click", ()=>{
        tabButtons.forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        const target = btn.dataset.tab;
        tabs.forEach(id=>{
          document.getElementById(id).style.display = (id===target) ? "block" : "none";
        });
        // a11y focus
        document.getElementById(target).scrollIntoView({behavior:"smooth", block:"start"});
      });
    });

    // ---------- Mode chips ----------
    const chips = Array.from(document.querySelectorAll("#modeChips .chip"));
    function setMode(mode){
      state.mode = mode;
      LS.set("seb_mode", mode);
      chips.forEach(c=>c.classList.toggle("active", c.dataset.mode===mode));
      showToast(mode==="ieic" ? "Modo I–E–I–C" : "Modo A–R–D–C");
    }
    chips.forEach(c=>{
      c.addEventListener("click", ()=>setMode(c.dataset.mode));
    });

    // ---------- Prompts ----------
    document.querySelectorAll("#practicePrompts .chip").forEach(ch=>{
      ch.addEventListener("click", ()=>{
        const text = ch.dataset.prompt || ch.textContent.trim();
        document.getElementById("qInput").value = text;
        copyToClipboard(text);
        showToast("Pregunta copiada");
      });
    });

    // ---------- Timer (10s + calm 30s) ----------
    let timerInt = null;
    let timerLeft = 10;

    function updateTimer(){
      const mm = String(Math.floor(timerLeft/60)).padStart(2,"0");
      const ss = String(timerLeft%60).padStart(2,"0");
      document.getElementById("timerVal").textContent = `${mm}:${ss}`;
    }

    function startTimer(seconds, hint){
      stopTimer();
      timerLeft = seconds;
      document.getElementById("timerHint").textContent = hint;
      updateTimer();
      timerInt = setInterval(()=>{
        timerLeft--;
        updateTimer();
        if(timerLeft<=0){
          stopTimer();
          navigator.vibrate?.(80);
          showToast("Listo. Ahora escribe con plantilla.");
        }
      }, 1000);
    }

    function stopTimer(){
      if(timerInt){
        clearInterval(timerInt);
        timerInt = null;
      }
    }

    document.getElementById("btn10s").addEventListener("click", ()=>{
      startTimer(10, "Esqueleto 10s: freno + orden");
      // focus skeleton for quick entry
      document.getElementById("skeletonInput").focus();
    });

    document.getElementById("btnStop").addEventListener("click", ()=>{
      stopTimer();
      showToast("Timer detenido");
    });

    document.getElementById("btnCalm").addEventListener("click", ()=>{
      startTimer(30, "Calma 30s: 4–6 x3 + vuelve al esqueleto");
      showToast("Respira 4–6 (x3)");
    });

    // ---------- Insert template ----------
    document.getElementById("btnInsertTemplate").addEventListener("click", ()=>{
      const box = document.getElementById("answerBox");
      const tpl = (state.mode==="ieic") ? TPL.ieic : TPL.ardc;
      if(box.value.trim().length>0){
        box.value = tpl + "\n\n" + box.value.trim();
      }else{
        box.value = tpl;
      }
      box.focus();
      showToast("Plantilla insertada");
    });

    // ---------- Quick Start 30s ----------
    document.getElementById("btnQuickStart").addEventListener("click", ()=>{
      const q = (document.getElementById("qInput").value || "").trim();
      if(!q){ showToast("Primero pega la pregunta"); return; }
      const s = (document.getElementById("skeletonInput").value || "").trim();
      if(!s){ showToast("Primero crea el esqueleto (3–5 palabras)"); return; }
      startTimer(30, "Arranque 30s: respiración + primera frase + cierre");
      const box = document.getElementById("answerBox");
      const header = `Pregunta: ${q}\nEsqueleto: ${s}\n\n`;
      const prompt =
        (state.mode==="ieic")
          ? "Escribe SOLO: 1 frase de Introducción + 1 frase de Cierre. Luego vuelves al cuerpo."
          : "Escribe SOLO: 1 frase de Afirmación + 1 frase de Conclusión. Luego vuelves al desarrollo.";
      if(!box.value.trim()){
        box.value = header + prompt + "\n\n";
      }
      box.focus();
      showToast("Arranque activado");
    });

    // ---------- Save practice ----------
    function savePractice(){
      const q = (document.getElementById("qInput").value || "").trim();
      const skeleton = (document.getElementById("skeletonInput").value || "").trim();
      const ans = (document.getElementById("answerBox").value || "").trim();
      if(!q){ showToast("Falta la pregunta"); return; }
      if(!skeleton){ showToast("Falta el esqueleto"); return; }
      if(ans.length < 20){ showToast("Escribe un poco más antes de guardar"); return; }

      const entry = { ts: Date.now(), q, skeleton, mode: state.mode, answer: ans };
      state.practices.unshift(entry);
      state.practices = state.practices.slice(0, 80);
      LS.set("seb_practices", state.practices);

      markTodayDone();
      updateKPIs();
      updateRecent();

      showToast("Práctica guardada ✅");
    }

    document.getElementById("btnSavePractice").addEventListener("click", savePractice);

    // ---------- Streak ----------
    function isYesterday(dateStr){
      const d = new Date(dateStr + "T00:00:00");
      const y = new Date();
      y.setHours(0,0,0,0);
      y.setDate(y.getDate()-1);
      return d.getTime() === y.getTime();
    }

    function markTodayDone(){
      const t = todayKey();
      const s = state.streak;

      if(s.last === t && s.todayDone) return;

      if(s.last === t){
        s.todayDone = true;
      }else{
        if(s.last && isYesterday(s.last)){
          s.count = Math.max(0, (s.count||0) + 1);
        }else{
          s.count = 1;
        }
        s.last = t;
        s.todayDone = true;
      }

      state.streak = s;
      LS.set("seb_streak", s);
      renderStreak();
    }

    function renderStreak(){
      const s = state.streak || {count:0};
      document.getElementById("streakVal").textContent = String(s.count || 0);
    }

    // ---------- KPIs / Recent ----------
    function practicesTodayCount(){
      const t = todayKey();
      return state.practices.filter(p => new Date(p.ts).toISOString().slice(0,10) === t).length;
    }

    function updateKPIs(){
      document.getElementById("kpiPractices").textContent = String(state.practices.length);
      document.getElementById("kpiToday").textContent = String(practicesTodayCount());
      document.getElementById("kpiCalm").textContent = state.calmToday.ok ? "OK" : "—";
    }

    function fmt(ts){
      const d = new Date(ts);
      const hh = String(d.getHours()).padStart(2,"0");
      const mm = String(d.getMinutes()).padStart(2,"0");
      return `${hh}:${mm}`;
    }

    function updateRecent(){
      const el = document.getElementById("recentList");
      if(!state.practices.length){
        el.textContent = "Aún no hay prácticas guardadas.";
        return;
      }
      const items = state.practices.slice(0,5).map(p=>{
        const shortQ = p.q.length>60 ? p.q.slice(0,60)+"…" : p.q;
        const mode = p.mode==="ieic" ? "I–E–I–C" : "A–R–D–C";
        return `• <strong>${fmt(p.ts)}</strong> · ${mode} · ${escapeHTML(shortQ)}`;
      }).join("<br/>");
      el.innerHTML = items;
    }

    // ---------- Exam checklist ----------
    const checklistItems = [
      { id:"breath", t:"3 respiraciones (4–6)", d:"Baja activación antes de leer/contestar." },
      { id:"read", t:"Leer toda la pregunta", d:"Sin empezar hasta entender qué pide." },
      { id:"keywords", t:"Subrayar palabras clave", d:"Qué, cómo, por qué, comparar, definir, aplicar." },
      { id:"skeleton", t:"Esqueleto 10s (3–5 palabras)", d:"Ordena antes de escribir." },
      { id:"choose", t:"Elegir plantilla", d:"I–E–I–C o A–R–D–C según el tipo de pregunta." },
      { id:"intro", t:"Escribir introducción/tesis", d:"Una frase clara para empezar." },
      { id:"oneidea", t:"1 párrafo = 1 idea", d:"Evita mezclar y saltar de tema." },
      { id:"connector", t:"Usar conectores", d:"Por ello, en consecuencia, esto implica…" },
      { id:"close", t:"Cierre obligatorio", d:"1–2 frases finales. Sin cierre = baja nota." },
      { id:"review", t:"Revisión rápida", d:"Ortografía básica + coherencia del cierre." }
    ];

    function ensureDailyChecklist(){
      const t = todayKey();
      if(!state.checklist || state.checklist.date !== t){
        state.checklist = { date: t, items: {} };
        LS.set("seb_checklist", state.checklist);
      }
    }

    function renderChecklist(){
      ensureDailyChecklist();
      const wrap = document.getElementById("examChecklist");
      wrap.innerHTML = "";
      checklistItems.forEach(item=>{
        const checked = !!state.checklist.items[item.id];
        const row = document.createElement("label");
        row.className = "checkrow";
        row.innerHTML = `
          <input type="checkbox" ${checked ? "checked" : ""} data-id="${item.id}" />
          <div>
            <p class="t">${escapeHTML(item.t)}</p>
            <p class="d">${escapeHTML(item.d)}</p>
          </div>
        `;
        wrap.appendChild(row);
      });

      wrap.querySelectorAll('input[type="checkbox"]').forEach(cb=>{
        cb.addEventListener("change", (e)=>{
          const id = e.target.dataset.id;
          state.checklist.items[id] = e.target.checked;
          LS.set("seb_checklist", state.checklist);
          showToast(e.target.checked ? "Marcado" : "Desmarcado");
        });
      });
    }

    document.getElementById("btnMarkAll").addEventListener("click", ()=>{
      ensureDailyChecklist();
      checklistItems.forEach(i=>state.checklist.items[i.id]=true);
      LS.set("seb_checklist", state.checklist);
      renderChecklist();
      showToast("Checklist completo ✅");
    });

    document.getElementById("btnClearAll").addEventListener("click", ()=>{
      ensureDailyChecklist();
      state.checklist.items = {};
      LS.set("seb_checklist", state.checklist);
      renderChecklist();
      showToast("Checklist limpio");
    });

    document.getElementById("btnResetDay").addEventListener("click", ()=>{
      // reset only daily items (checklist + calm)
      state.checklist = { date: todayKey(), items: {} };
      state.calmToday = { date: todayKey(), ok:false };
      LS.set("seb_checklist", state.checklist);
      LS.set("seb_calm_today", state.calmToday);
      renderChecklist();
      updateKPIs();
      showToast("Día reiniciado");
    });

    // ---------- Notes ----------
    function loadNotes(){
      document.getElementById("notesBox").value = state.notes || "";
      document.getElementById("mantraInput").value = state.mantra || "";
      document.getElementById("connectorsInput").value = state.connectors || "";
      document.getElementById("mantraText").textContent = state.mantra || "";
      document.getElementById("connectorsView").textContent = state.connectors || "";
    }

    document.getElementById("btnSaveNotes").addEventListener("click", ()=>{
      state.notes = document.getElementById("notesBox").value || "";
      state.mantra = (document.getElementById("mantraInput").value || "").trim() || "Orden > velocidad. Respondo con guion.";
      state.connectors = (document.getElementById("connectorsInput").value || "").trim() || "Por ello · En consecuencia · Esto implica · Además";
      LS.set("seb_notes", state.notes);
      LS.set("seb_mantra", state.mantra);
      LS.set("seb_connectors", state.connectors);

      document.getElementById("mantraText").textContent = state.mantra;
      document.getElementById("connectorsView").textContent = state.connectors;

      showToast("Guardado");
    });

    document.getElementById("btnWipeAll").addEventListener("click", ()=>{
      // wipe all app data
      if(!confirm("¿Borrar todo? (prácticas, notas, checklist, racha)")) return;
      localStorage.removeItem("seb_mode");
      localStorage.removeItem("seb_practices");
      localStorage.removeItem("seb_notes");
      localStorage.removeItem("seb_mantra");
      localStorage.removeItem("seb_connectors");
      localStorage.removeItem("seb_calm_today");
      localStorage.removeItem("seb_checklist");
      localStorage.removeItem("seb_streak");
      location.reload();
    });

    // ---------- Calm ok ----------
    function ensureCalmDay(){
      const t = todayKey();
      if(!state.calmToday || state.calmToday.date !== t){
        state.calmToday = { date: t, ok:false };
        LS.set("seb_calm_today", state.calmToday);
      }
    }
    document.getElementById("btnSetCalmOk").addEventListener("click", ()=>{
      ensureCalmDay();
      state.calmToday.ok = true;
      LS.set("seb_calm_today", state.calmToday);
      updateKPIs();
      showToast("Calma: OK");
    });

    // ---------- Copy helpers ----------
    async function copyToClipboard(text){
      try{
        await navigator.clipboard.writeText(text);
      }catch(e){
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
      }
    }

    document.querySelectorAll("[data-copy]").forEach(btn=>{
      btn.addEventListener("click", async ()=>{
        const which = btn.dataset.copy;
        const text = (which==="tpl_ieic") ? TPL.ieic : TPL.ardc;
        await copyToClipboard(text);
        showToast("Plantilla copiada");
      });
    });

    document.getElementById("btnCopyConnectors").addEventListener("click", async ()=>{
      await copyToClipboard(state.connectors || "");
      showToast("Conectores copiados");
    });

    // ---------- Escape for recent list HTML ----------
    function escapeHTML(str){
      return String(str).replace(/[&<>"']/g, (m)=>({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    // ---------- Initialize ----------
    function init(){
      // mode
      setMode(state.mode);

      // daily resets
      ensureDailyChecklist();
      ensureCalmDay();

      // load notes UI
      loadNotes();

      // checklist
      renderChecklist();

      // recent + KPIs + streak
      renderStreak();
      updateKPIs();
      updateRecent();

      // if mantra saved
      document.getElementById("mantraText").textContent = state.mantra || "Orden > velocidad. Respondo con guion.";
      document.getElementById("connectorsView").textContent = state.connectors || "Por ello · En consecuencia · Esto implica · Además";

      // keyboard-friendly: when question changes, keep answer box clean if empty
      document.getElementById("qInput").addEventListener("blur", ()=>{
        const v = document.getElementById("qInput").value.trim();
        if(v.length>0) showToast("Pregunta lista");
      });

      // small helper: if user changes mode, offer template
      chips.forEach(c=>{
        c.addEventListener("click", ()=>{
          // nothing extra
        });
      });
    }

    init();
  </script>
</body>
</html>
